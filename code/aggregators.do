_g2004_2003_2004 _g2004_2003_2005 _g2004_2003_2006 _g2004_2003_2007 _g2006_2005_2006 _g2006_2005_2007 _g2007_2006_2007
program drop myols2
program myols2
	syntax anything
	*display "`anything'"
	local my $ML_y
	gettoken lnf 1:0
	qui: {
		replace `lnf'=0
		while "`1'"!="" {
		    local cnt = `cnt'+1
			gettoken xx 1:1
			gettoken yy my:my
			*display in w "`lnf'-(`yy'-`xx')^2 if `yy' !=."
			replace `lnf'=`lnf'-(`yy'-`xx')^2 if `yy' !=. 
 
		}
	}
end

tab first_treat if , gen(f_)
replace f_2 =. if first==0
replace f_3 =. if first==0
replace f_4 =. if first==0

 _g2004_2003_2004 _g2004_2003_2005 _g2004_2003_2006 _g2004_2003_2007
 _g2006_2003_2004 _g2006_2004_2005 _g2006_2005_2006 _g2006_2005_2007 
 _g2007_2003_2004 _g2007_2004_2005 _g2007_2005_2006 _g2007_2006_2007

ml model lf myols2 (xb1: _g2004_2003_2004=) (xb2: _g2004_2003_2005=) (xb3: _g2004_2003_2006=) (xb4: _g2004_2003_2007=) ///
				   (xb5: _g2006_2003_2004=) (xb6: _g2006_2004_2005=) (xb7: _g2006_2005_2006=) (xb8: _g2006_2005_2007=) ///
				   (xb9: _g2007_2003_2004=) (xb10:_g2007_2004_2005=) (xb11:_g2007_2005_2006=) (xb12:_g2007_2006_2007=) ///
				   (w1: f_2 =) (w2:f_3=) (w3:f_4=), maximize miss robust
ml display
matrix b=e(b)
matrix V=e(V)

matrix coleq b = g2004 g2004 g2004 g2004 g2006 g2006 g2006 g2006 g2007 g2007 g2007 g2007 wgt wgt wgt
matrix coleq V = g2004 g2004 g2004 g2004 g2006 g2006 g2006 g2006 g2007 g2007 g2007 g2007 wgt wgt wgt
matrix roweq V = g2004 g2004 g2004 g2004 g2006 g2006 g2006 g2006 g2007 g2007 g2007 g2007 wgt wgt wgt

matrix colname b = t_2003_2004 t_2003_2005 t_2003_2006 t_2003_2007 ///
				 t_2003_2004 t_2004_2005 t_2005_2006 t_2005_2007 ///
				 t_2003_2004 t_2004_2005 t_2005_2006 t_2006_2007 w2004 w2006 w2007
matrix colname V = t_2003_2004 t_2003_2005 t_2003_2006 t_2003_2007 ///
				 t_2003_2004 t_2004_2005 t_2005_2006 t_2005_2007 ///
				 t_2003_2004 t_2004_2005 t_2005_2006 t_2006_2007 w2004 w2006 w2007
matrix rowname V = t_2003_2004 t_2003_2005 t_2003_2006 t_2003_2007 ///
				 t_2003_2004 t_2004_2005 t_2005_2006 t_2005_2007 ///
				 t_2003_2004 t_2004_2005 t_2005_2006 t_2006_2007 w2004 w2006 w2007				  
adde repost b=b V=V, rename				 
** Simple				   
nlcom (Simple: ((_b[g2004:t_2003_2004]+_b[g2004:t_2003_2005]+_b[g2004:t_2003_2006]+_b[g2004:t_2003_2007])*_b[wgt:w2004]+ 	   (_b[g2006:t_2005_2006]+_b[g2006:t_2005_2007])*_b[wgt:w2006]+_b[g2007:t_2006_2007]*_b[wgt:w2007])/(_b[wgt:w2004]*4+_b[wgt:w2006]*2+_b[wgt:w2007]) )
** event 
nlcom (E_1: ( _b[g2006:t_2004_2005]*_b[wgt:w2006]+ ///
	         _b[g2007:t_2005_2006]*_b[wgt:w2007]) /// 
			/(_b[wgt:w2006]+_b[wgt:w2007])) ///   
(E0: ( _b[g2004:t_2003_2004]*_b[wgt:w2004]+ ///
	         _b[g2006:t_2005_2006]*_b[wgt:w2006]+ ///
	         _b[g2007:t_2006_2007]*_b[wgt:w2007]) /// 
			/(_b[wgt:w2004]+_b[wgt:w2006]+_b[wgt:w2007]))	///   
	(E1: ((_b[g2004:t_2003_2005])*_b[wgt:w2004]+ ///
	   (_b[g2006:t_2005_2007])*_b[wgt:w2006])/(_b[wgt:w2004]+_b[wgt:w2006]))	///
	(E2: ((_b[g2004:t_2003_2006])*_b[wgt:w2004]) /(_b[wgt:w2004]))	   ///
	(E3: ((_b[g2004:t_2003_2007])*_b[wgt:w2004]) /(_b[wgt:w2004]))	 

/*
         -3  0.0267     0.0144       -0.0107      0.0642  
         -2 -0.0036     0.0136       -0.0390      0.0318  
         -1 -0.0232     0.0139       -0.0593      0.0128  
          0 -0.0211     0.0114       -0.0507      0.0086  
          1 -0.0530     0.0166       -0.0962     -0.0099 *
          2 -0.1404     0.0368       -0.2360     -0.0449 *
          3 -0.1069     0.0343       -0.1960     -0.0178 *
*/	
	
nlcom ((_b[xb1:_cons]+_b[xb2:_cons]+_b[xb3:_cons]+_b[xb4:_cons])/4)

nlcom ((_b[xb1:_cons]+_b[xb2:_cons]+_b[xb3:_cons]+_b[xb4:_cons])/4)
	   
nlcom ((_b[xb3:_cons] +_b[xb7:_cons] )/2)

nlcom ((_b[xb4:_cons] +_b[xb8:_cons]+_b[xb12:_cons] )/3)

	   